-- drop objects
drop table departments cascade constraints;
drop table cities cascade constraints;
drop table stores cascade constraints;
drop table employees cascade constraints;
drop table products cascade constraints;

-- create tables
create table departments (
    id                             number generated by default on null as identity 
                                   constraint departments_id_pk primary key,
    name                           varchar2(50 char) constraint departments_name_unq unique not null
)
;

create table cities (
    id                             number generated by default on null as identity 
                                   constraint cities_id_pk primary key,
    department_id                  number
                                   constraint cities_department_id_fk
                                   references departments on delete cascade,
    name                           varchar2(100 char) not null
)
;

-- table index
create index cities_i1 on cities (department_id);

create table stores (
    id                             number generated by default on null as identity 
                                   constraint stores_id_pk primary key,
    city_id                        number
                                   constraint stores_city_id_fk
                                   references cities on delete cascade,
    name                           varchar2(30 char) not null,
    adress                         varchar2(100 char) not null,
    administrator                  number
                                   constraint stores_administrator_fk
                                   references employees on delete cascade not null
)
;

-- table index
create index stores_i1 on stores (administrator);
create index stores_i2 on stores (city_id);

create table employees (
    cedula                         number generated by default on null as identity 
                                   constraint employees_cedula_pk primary key,
    name                           varchar2(255 char) not null,
    position                       varchar2(40 char) constraint employees_position_cc
                                   check (position in ('SELLER','ADMINISTRATOR')) not null,
    email                          varchar2(200 char) not null,
    hiring_date                    date not null,
    gender                         varchar2(6 char) constraint employees_gender_cc
                                   check (gender in ('MALE','FEMALE','OTHER')) not null,
    boss                           number
                                   constraint employees_boss_fk
                                   references employees on delete cascade not null,
    store_work                     number
                                   constraint employees_store_work_fk
                                   references stores on delete cascade
)
;

-- table index
create index employees_i1 on employees (boss);
create index employees_i2 on employees (store_work);

create table products (
    id                             number generated by default on null as identity 
                                   constraint products_id_pk primary key,
    name                           varchar2(50 char)
                                   constraint products_name_unq unique not null,
    gross_value                    number not null,
    discount_rate_max              number not null,
    net_price                      number not null,
    description                    varchar2(1000 char),
    store_location                 number
                                   constraint products_store_location_fk
                                   references stores on delete cascade
)
;

-- table index
create index products_i1 on products (store_location);


-- triggers
create or replace trigger employees_biu
    before insert or update 
    on employees
    for each row
begin
    :new.email := lower(:new.email);
end employees_biu;
/

-- load data
 
insert into departments (
    id,
    name
) values (
    1,
    'ANTIOQUIA'
);

insert into departments (
    id,
    name
) values (
    2,
    'ATLANTICO'
);

insert into departments (
    id,
    name
) values (
    3,
    'CUNDINAMARCA'
);

insert into departments (
    id,
    name
) values (
    4,
    'MAGDALENA'
);

insert into departments (
    id,
    name
) values (
    5,
    'VALLE DEL CAUCA'
);

commit;
-- load data
select 
    ID,
    NAME
from DEPARTMENTS;

-- load data
 
insert into cities (
    id,
    department_id,
    name
) values (
    1,
    5,
    'Load Balancer Certificate Upgrade'
);

commit;
select 
    ID,
    DEPARTMENT_ID,
    NAME
from CITIES;

-- load data
 
insert into stores (
    id,
    city_id,
    name,
    adress,
    administrator
) values (
    1,
    1,
    'Load Balancer Certificate Upgr',
    'Vestibulum eget rhoncus non,molestie sit amet lectus. Nulla placerat iaculis aliquam. Vestibulum lac',
    1
);

commit;
select 
    ID,
    CITY_ID,
    NAME,
    ADRESS,
    ADMINISTRATOR
from STORES;

-- load data
 
insert into employees (
    cedula,
    name,
    position,
    email,
    hiring_date,
    boss,
    store_work
) values (
    71,
    'Gricelda Luebbers',
    'SELLER',
    'gricelda.luebbers@aaab.com',
    sysdate - 62,
    1,
    1
);

commit;
select 
    CEDULA,
    NAME,
    POSITION,
    EMAIL,
    HIRING_DATE,
    BOSS,
    STORE_WORK
from EMPLOYEES;

-- load data
 
insert into products (
    id,
    name,
    gross_value,
    discount_rate_max,
    net_price,
    description,
    store_location
) values (
    1,
    'M-AADC-80',
    60,
    33,
    24,
    'Consectetur mi venenatis nec. Donec convallis sollicitudin elementum. Nulla facilisi. In posuere blandit leoeget malesuada. Vivamus efficitur ipsum tellus, quis posuere mi maximus vitae. Quisque tortor odio, feugiat eget sagittisvel, pretium ut metus. Duis et commodo arcu, in vestibulum tellus. In sollicitudin nisi mi, pharetra gravida ex semper ut.Donec nibh sapien, hendrerit quis varius eget, malesuada vitae turpis. Lorem ipsum dolor sit amet, consectetur adipiscing elit.Vivamus sapien sem, volutpat vitae luctus vitae, pretium.',
    1
);

commit;
select 
    ID,
    NAME,
    GROSS_VALUE,
    DISCOUNT_RATE_MAX,
    NET_PRICE,
    DESCRIPTION,
    STORE_LOCATION
from PRODUCTS;

